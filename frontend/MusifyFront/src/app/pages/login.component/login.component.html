<div class="container" #container>
  <!-- Registration Form -->
  <div class="form-container sign-up-container">
    <form [formGroup]="registerForm" (ngSubmit)="onRegister()">
      <h1>Crear cuenta</h1>

      <!-- Error Message -->
      <div *ngIf="errorMessage()" class="alert alert-danger">
        {{ errorMessage() }}
      </div>

      <!-- Success Message -->
      <div *ngIf="successMessage()" class="alert alert-success">
        {{ successMessage() }}
      </div>

      <!-- Username Field -->
      <div class="form-group">
        <input type="text" formControlName="username" placeholder="Nombre"
          [class.is-invalid]="registerForm.get('username')?.invalid && registerForm.get('username')?.touched" />
        <div *ngIf="registerForm.get('username')?.invalid && registerForm.get('username')?.touched"
          class="invalid-feedback">
          <div *ngIf="registerForm.get('username')?.errors?.['required']">El nombre de usuario es requerido</div>
        </div>
      </div>

      <!-- Email Field -->
      <div class="form-group">
        <input type="email" formControlName="email" placeholder="Email"
          [class.is-invalid]="registerForm.get('email')?.invalid && registerForm.get('email')?.touched" />
        <div *ngIf="registerForm.get('email')?.invalid && registerForm.get('email')?.touched" class="invalid-feedback">
          <div *ngIf="registerForm.get('email')?.errors?.['required']">El email es requerido</div>
          <div *ngIf="registerForm.get('email')?.errors?.['email']">Por favor ingresa un email válido</div>
        </div>
      </div>

      <!-- Password Field -->
      <div class="form-group">
        <input type="password" formControlName="password" placeholder="Contraseña"
          [class.is-invalid]="registerForm.get('password')?.invalid && registerForm.get('password')?.touched" />
        <div *ngIf="registerForm.get('password')?.invalid && registerForm.get('password')?.touched"
          class="invalid-feedback">
          <div *ngIf="registerForm.get('password')?.errors?.['required']">La contraseña es requerida</div>
          <div *ngIf="registerForm.get('password')?.errors?.['minlength']">La contraseña debe tener al menos 6 caracteres</div>
        </div>
      </div>

      <!-- Submit Button -->
      <button type="submit" [disabled]="isRegisterButtonDisabled()">
        <span *ngIf="!loading()">Crear cuenta</span>
        <span *ngIf="loading()">
          <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
          Creando...
        </span>
      </button>
    </form>
  </div>

  <!-- Login Form -->
  <div class="form-container sign-in-container">
    <!-- Show login form if not logged in -->
    <form *ngIf="!isLoggedIn()" [formGroup]="loginForm" (ngSubmit)="onLogin()">
      <h1>Iniciar Sesión</h1>

      <!-- Error Message -->
      <div *ngIf="errorMessage()" class="alert alert-danger">
        {{ errorMessage() }}
      </div>

      <!-- Success Message -->
      <div *ngIf="successMessage()" class="alert alert-success">
        {{ successMessage() }}
      </div>       <!-- Email Field -->
      <div class="form-group">
        <input type="email" formControlName="email" placeholder="Email"
          [class.is-invalid]="loginForm.get('email')?.invalid && loginForm.get('email')?.touched" />
        <div *ngIf="loginForm.get('email')?.invalid && loginForm.get('email')?.touched" class="invalid-feedback">
          <div *ngIf="loginForm.get('email')?.errors?.['required']">El email es requerido</div>
          <div *ngIf="loginForm.get('email')?.errors?.['email']">Por favor ingresa un email válido</div>
        </div>
      </div>

      <!-- Password Field -->
      <div class="form-group">
        <input type="password" formControlName="password" placeholder="Contraseña"
          [class.is-invalid]="loginForm.get('password')?.invalid && loginForm.get('password')?.touched" />
        <div *ngIf="loginForm.get('password')?.invalid && loginForm.get('password')?.touched" class="invalid-feedback">
          <div *ngIf="loginForm.get('password')?.errors?.['required']">La contraseña es requerida</div>
          <div *ngIf="loginForm.get('password')?.errors?.['minlength']">La contraseña debe tener al menos 6 caracteres</div>
        </div>
      </div>

      <!-- Submit Button -->
      <button type="submit" [disabled]="isLoginButtonDisabled()">
        <span *ngIf="!loading()">Iniciar Sesión</span>
        <span *ngIf="loading()">
          <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
          Iniciando...
        </span>
      </button>
    </form>

    <!-- Show logged-in info if logged in -->
    <div *ngIf="isLoggedIn()" class="user-info">
      <h2>Sesión Iniciada</h2>

      <!-- Error Message -->
      <div *ngIf="errorMessage()" class="alert alert-danger">
        {{ errorMessage() }}
      </div>

      <!-- Success Message -->
      <div *ngIf="successMessage()" class="alert alert-success">
        {{ successMessage() }}
      </div>

      <div class="user-details" *ngIf="currentUser()">
        <p><strong>Usuario:</strong> {{ currentUser()?.username || currentUser()?.email }}</p>
        <p><strong>Email:</strong> {{ currentUser()?.email }}</p>
      </div>

      <button (click)="onLogout()" class="logout-btn">
        <span *ngIf="!loading()">Cerrar Sesión</span>
        <span *ngIf="loading()" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
      </button>
    </div>
  </div>

  <!-- Overlay Panel -->
  <div class="overlay-container">
    <div class="overlay">
      <div class="overlay-panel overlay-left">
        <h1>Bienvenido</h1>
        <p>Si ya tiene una cuenta activa, inicie sesión.</p>
        <button class="ghost" id="signIn" (click)="singInClick()">Iniciar Sesión</button>
      </div>
      <div class="overlay-panel overlay-right">
        <h1>Registrese</h1>
        <p>Si no tiene una cuenta activa, considere unirse a nuestra web.</p>
        <button class="ghost" id="signUp" (click)="singUpClick()">Registrar</button>
      </div>
    </div>
  </div>
</div>